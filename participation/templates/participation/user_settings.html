{% extends 'participation/base.html' %}

{% block title %}
用户中心 - 我的资料
{% endblock %}

{% block css %}
{{ block.super }}
<style type="text/css">
.new-msg-badge {
    margin-left: 5px;
    margin-bottom: 5px;
}
.weui-btn-area {
    margin-top: 5px;
    margin-bottom: 15px;
}
</style>
{% endblock %}

{% block body %}
<div class="bottom-nav">
    <div class="bottom-nav-tab"><a class="bottom-nav-tab-text" href="/activities">活动</a></div>
    <div class="bottom-nav-tab"><a class="bottom-nav-tab-text" href="/messages">消息<span class="weui-badge new-msg-badge">1</span></a></div>
    <div class="bottom-nav-tab active"><a class="bottom-nav-tab-text" href="/settings">设置</a></div>
</div>

<div class="navbar-header navbar-header-user">
    <span class="navbar-header-text">
        欢迎你，{{ userinfo.name }}老师！
    </span>
</div>

<div class="user-content-wrapper">
    <div class="weui-cells weui-cells_form">
        <div class="weui-cell">
            <div class="weui-cell__hd"><label class="weui-label">用户名</label></div>
            <div class="weui-cell__bd">
                <input class="weui-input" type="text" name="username" disabled value="{{ userinfo.username }}">
            </div>
        </div>
        <div class="weui-cell">
            <div class="weui-cell__hd"><label class="weui-label">真实姓名</label></div>
            <div class="weui-cell__bd">
                <input class="weui-input" type="text" name="real_name" disabled value="{{ userinfo.name }}">
            </div>
        </div>
        <div class="weui-cell">
            <div class="weui-cell__hd"><label class="weui-label">性别</label></div>
            <div class="weui-cell__bd">
                <input class="weui-input" type="text" name="sex" disabled value="{{ userinfo.sex_text }}">
            </div>
        </div>
        <div class="weui-cell">
            <div class="weui-cell__hd"><label class="weui-label">工号</label></div>
            <div class="weui-cell__bd">
                <input class="weui-input" type="text" name="wid" disabled value="{{ userinfo.wid }}">
            </div>
        </div>
        <div class="weui-cell">
            <div class="weui-cell__hd"><label class="weui-label">所属单位</label></div>
            <div class="weui-cell__bd">
                <input class="weui-input" type="text" name="department" disabled value="{{ userinfo.department_text }}">
            </div>
        </div>
        <div class="weui-cell">
            <div class="weui-cell__hd"><label class="weui-label">所属公会</label></div>
            <div class="weui-cell__bd">
                <input class="weui-input" type="text" name="sub_union" disabled value="{{ userinfo.sub_union_text }}">
            </div>
        </div>        
    </div>

    <div class="weui-cells__title">联系方式</div>
    <div class="weui-cells weui-cells_form">
        <div class="weui-cell">
            <div class="weui-cell__hd"><label class="weui-label">手机号码</label></div>
            <div class="weui-cell__bd">
                <input class="weui-input" type="tel" placeholder="请输入手机号码" name="mobile" value="{{ userinfo.mobile }}">         
            </div>
        </div>
    </div>
    <div class="weui-cells__tips">我们可能会向您的手机发送通知</div>
    <div class="weui-cells weui-cells_form form-margin-0">
        <div class="weui-cell">
            <div class="weui-cell__hd"><label class="weui-label">邮箱地址</label></div>
            <div class="weui-cell__bd">
                <input class="weui-input" type="email" placeholder="请输入邮箱地址" name="email" value="{{ userinfo.email }}">
            </div>
        </div>
    </div>
    <div class="weui-cells__tips">我们可能会向您的邮箱发送通知</div>
    <div class="weui-btn-area">
        <button class="weui-btn weui-btn_default" id="register_btn" onclick="setInfo()">
            <span>确认修改联系方式</span>
        </button>
    </div>


    <div class="weui-cells__title">密码修改</div>
    <div class="weui-cells weui-cells_form">
        <div class="weui-cell">
            <div class="weui-cell__bd">
                <input class="weui-input" type="password" placeholder="请输入新密码" name="pwd_new">         
            </div>
        </div>
        <div class="weui-cell">
            <div class="weui-cell__bd">
                <input class="weui-input" type="password" placeholder="请再次输入新密码" name="pwd_new_2">         
            </div>
        </div>        
    </div>
    <div class="weui-btn-area">
        <button class="weui-btn weui-btn_default" id="register_btn">
            <span>确认修改密码</span>
        </button>
    </div>

    <div class="weui-cells__title">退出登录</div>
    <div class="weui-btn-area">
        <button class="weui-btn weui-btn_warn" id="logout_btn" onclick="logout()">
            <span>登出</span>
        </button>
    </div>
</div>
{% endblock %}

{% block js %}
{{ block.super }}
<script type="text/javascript">
logout = function() {
    window.location.href = '/logout';
}

setInfo = function() {
    var mobile = $('input[name="mobile"]').val();
    var email = $('input[name="email"]').val();
    $.post('/settings/set', {
        mobile: mobile,
        email: email
    })
    .done(function(data, status) {
        if(data.status == 'success') {
            weui.toast(data.msg, {duration: 3000});
        }
        else if(data.status == 'error') {
            weui.topTips(data.msg, 3000);
        }
        else {
            weui.topTips('未知错误，请稍后再试', 3000);
        }
    })
    .fail(function() {
        weui.topTips('网络状况不佳，请稍后再试', 3000);
    })
}

</script>
{% endblock %}